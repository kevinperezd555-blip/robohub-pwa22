<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RoboHub Ultimate</title>
<style>
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#f4f4f4; transition:0.3s; }
body.dark { background:#1a1a1a; color:white; }
nav { background:#2575fc; color:white; display:flex; justify-content:space-between; align-items:center; padding:10px 20px; position:sticky; top:0; box-shadow:0 3px 10px rgba(0,0,0,0.2); z-index:10; }
nav button { border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:bold; transition:0.3s; }
nav button:hover { opacity:0.8; }
.container { display:grid; grid-template-columns:1fr 1fr; gap:20px; padding:20px; }
.card { background:white; padding:20px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); transition:0.3s; }
body.dark .card { background:#333; color:white; }
ul { list-style:none; padding:0; }
li { background:#f4f4f4; margin:5px 0; padding:10px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; cursor:grab; transition:0.2s; }
li.dragging { opacity:0.5; }
li:hover { background:#e0e0e0; }
body.dark li { background:#444; }
body.dark li:hover { background:#555; }
.btn { background:#2575fc; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; transition:0.3s; }
.btn:hover { background:#6a11cb; }
.ghost { background:#eee; color:#333; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; transition:0.3s; }
.ghost:hover { background:#ddd; }
.priority-high { color:#dc3545; font-weight:bold; }
.priority-medium { color:#ffc107; font-weight:bold; }
.priority-low { color:#28a745; font-weight:bold; }
#toast { position:fixed; bottom:10px; right:10px; background:#222; color:white; padding:10px 15px; border-radius:5px; display:none; z-index:20; }
.alert { background:#dc3545; color:white; padding:10px; margin-bottom:10px; border-radius:6px; box-shadow:0 3px 10px rgba(0,0,0,0.2); }
canvas { max-width:100%; height:auto; }
input, select { padding:10px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; width:100%; }
</style>
</head>
<body>

<audio id="alertSound" src="https://www.myinstants.com/media/sounds/bleep.mp3"></audio>
<div id="toast"></div>

<!-- LOGIN SCREEN -->
<div id="loginScreen" style="display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);">
  <div style="background:white;padding:40px 50px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.2);width:350px; text-align:center;">
    <h1 style="margin-bottom:20px;color:#2575fc;">ü§ñ RoboHub</h1>
    <input id="username" placeholder="Username"/>
    <input id="password" type="password" placeholder="Password"/>
    <select id="role">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
    </select>
    <button class="btn" onclick="signIn()" style="width:100%;margin-top:10px;">Sign In</button>
    <button class="ghost" onclick="autofillDemo()" style="width:100%;margin-top:10px;">Quick Demo</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp" style="display:none;">
<nav>
  <div style="font-weight:bold;font-size:18px;">ü§ñ RoboHub - <span id="navUser"></span></div>
  <div>
    <button onclick="toggleDarkMode()">üåì Dark Mode</button>
    <button onclick="signOut()" style="background:#dc3545;">Logout</button>
  </div>
</nav>
<div class="container">
  <div class="card" id="alerts"></div>

  <div class="card">
    <h2>üì¶ Inventory</h2>
    <input type="text" id="inventorySearch" placeholder="Search inventory..." onkeyup="renderInventory()"/>
    <ul id="inventoryList"></ul>
    <button class="btn" id="addInventoryBtn" onclick="addInventory()">+ Add Item</button>
  </div>

  <div class="card">
    <h2>üìù Tasks</h2>
    <input type="text" id="taskSearch" placeholder="Search tasks..." onkeyup="renderTasks()"/>
    <ul id="taskList"></ul>
    <button class="btn" id="addTaskBtn" onclick="addTask()">+ Add Task</button>
  </div>

  <div class="card" style="grid-column:span 2;">
    <h2>üìä Dashboard</h2>
    <canvas id="taskChart"></canvas>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== DATA =====
let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

// ===== DEMO DATA =====
if(!localStorage.getItem("inventory")){
    inventory = [
        {name:"Servo", qty:3},
        {name:"Motor", qty:5},
        {name:"Sensor", qty:7},
        {name:"Battery", qty:2}
    ];
    localStorage.setItem("inventory", JSON.stringify(inventory));
}
if(!localStorage.getItem("tasks")){
    tasks = [
        {text:"Build chassis", assignee:"Jacob", priority:"High", done:false, due:"2025-09-30"},
        {text:"Wire motors", assignee:"Kevin", priority:"Medium", done:false, due:"2025-09-28"},
        {text:"Test sensors", assignee:"Alex", priority:"Low", done:false, due:"2025-10-01"},
        {text:"Update firmware", assignee:"Sam", priority:"High", done:false, due:"2025-09-29"}
    ];
    localStorage.setItem("tasks", JSON.stringify(tasks));
}

// ===== LOGIN =====
function signIn(){
const username = document.getElementById('username').value.trim();
const password = document.getElementById('password').value.trim();
const role = document.getElementById('role').value;
if(username && password){
localStorage.setItem('username', username);
localStorage.setItem('role', role);
document.getElementById('loginScreen').style.display='none';
document.getElementById('mainApp').style.display='block';
document.getElementById('navUser').textContent=username+' ('+role+')';
renderAll(); applyRoleRestrictions(); showToast('Signed in as '+username);
}else alert("Enter username and password.");
}
function signOut(){ localStorage.removeItem('username'); localStorage.removeItem('role'); document.getElementById('mainApp').style.display='none'; document.getElementById('loginScreen').style.display='flex'; showToast('Signed out'); }
function autofillDemo(){ document.getElementById('username').value="demoUser"; document.getElementById('password').value="demoPass"; }

// ===== ROLES =====
function applyRoleRestrictions(){
const role = localStorage.getItem('role');
document.getElementById("addInventoryBtn").style.display=(role==='teacher')?"inline-block":"none";
document.getElementById("addTaskBtn").style.display=(role==='teacher')?"inline-block":"none";
renderAll(); updateChart(); updateAlerts(); enableDragDrop();
}
function toggleDarkMode(){ document.body.classList.toggle('dark'); }

// ===== INVENTORY =====
function renderInventory(){
const search = document.getElementById("inventorySearch")?.value.toLowerCase()||"";
const list = document.getElementById("inventoryList"); if(!list) return; list.innerHTML="";
inventory.forEach((item, idx)=>{
if(item.name.toLowerCase().includes(search)){
const li = document.createElement("li");
let lowStock = item.qty<=2 ? " üî¥" : "";
li.innerHTML=`${item.name} (Qty: ${item.qty})${lowStock} ${localStorage.getItem('role')==='teacher'? `<button onclick="deleteInventory(${idx})">Delete</button>`:""}`;
list.appendChild(li);
}
}); updateAlerts();
}
function addInventory(){ const name = prompt("Item name:"); const qty = parseInt(prompt("Quantity:"),10); if(name && !isNaN(qty)){ inventory.push({name,qty}); localStorage.setItem("inventory",JSON.stringify(inventory)); renderInventory(); showToast('Inventory added'); } }
function deleteInventory(i){ inventory.splice(i,1); localStorage.setItem("inventory",JSON.stringify(inventory)); renderInventory(); showToast('Inventory deleted'); }

// ===== TASKS =====
function renderTasks(){
const search=document.getElementById("taskSearch")?.value.toLowerCase()||"";
const list=document.getElementById("taskList"); if(!list) return; list.innerHTML="";
tasks.sort((a,b)=> new Date(a.due||0)- new Date(b.due||0));
tasks.forEach((t, idx)=>{
if(t.text.toLowerCase().includes(search)){
const priorityClass = t.priority==='High'? 'priority-high': t.priority==='Medium'? 'priority-medium':'priority-low';
const role = localStorage.getItem('role');
const username = localStorage.getItem('username');
const studentButton = (role==='student' && username===t.assignee && !t.done)? `<button onclick="completeTask(${idx})">Mark Done</button>`:"";
const teacherButtons = (role==='teacher')? `<button onclick="deleteTask(${idx})">Delete</button>`:"";
const dueText = t.due? ` | Due: ${t.due}`:"";
const doneMark = t.done? " ‚úÖ":"";
const li = document.createElement("li");
li.dataset.index=idx;
li.innerHTML=`<span class="${priorityClass}">${t.text} (assigned: ${t.assignee})${dueText}</span> ${teacherButtons} ${studentButton} ${doneMark}`;
list.appendChild(li);
}
}); updateChart(); updateAlerts(); enableDragDrop();
}
function addTask(){ 
const text = prompt("Task description:"); 
const assignee = prompt("Assign to (username):");
const priority = prompt("Priority: High / Medium / Low","Medium"); 
const due = prompt("Due date (YYYY-MM-DD):","");
if(text && assignee){ tasks.push({text,assignee,priority,done:false,due}); localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task added'); }
}
function completeTask(i){ tasks[i].done=true; localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task completed'); }
function deleteTask(i){ tasks.splice(i,1); localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task deleted'); }

// ===== ALERTS =====
function updateAlerts(){
const alertsDiv=document.getElementById('alerts'); if(!alertsDiv) return; alertsDiv.innerHTML="";
const today=new Date(); 
let playSound=false;
tasks.forEach(t=>{
if(!t.done && t.due && new Date(t.due)<today){
const div=document.createElement("div"); div.className="alert"; div.textContent=`Overdue task: ${t.text} (assigned: ${t.assignee})`; alertsDiv.appendChild(div); playSound=true;
}
});
inventory.forEach(item=>{
if(item.qty<=2){ const div=document.createElement("div"); div.className="alert"; div.textContent=`Low stock: ${item.name} (${item.qty})`; alertsDiv.appendChild(div); playSound=true; }
});
if(playSound){ document.getElementById('alertSound')?.play(); }
}

// ===== CHART =====
function updateChart(){
const ctx=document.getElementById("taskChart"); if(!ctx) return;
const done = tasks.filter(t=>t.done).length;
const pending = tasks.length - done;
new Chart(ctx,{type:'doughnut',data:{labels:['Done','Pending'],datasets:[{data:[done,pending],backgroundColor:['#28a745','#ffc107']}]},options:{responsive:true}});
}

// ===== DRAG & DROP =====
function enableDragDrop(){
const role = localStorage.getItem('role'); 
if(role!=='teacher') return;
const list=document.getElementById('taskList'); 
if(!list) return;
let dragged=null;
[...list.children].forEach(li=>{
li.draggable=true;
li.addEventListener('dragstart', e=>{ dragged=li; li.classList.add('dragging'); });
li.addEventListener('dragend', e=>{ dragged=null; li.classList.remove('dragging'); reorderTasks(); });
li.addEventListener('dragover', e=>{ e.preventDefault(); const bounding = li.getBoundingClientRect(); const offset = e.clientY - bounding.top; if(offset>bounding.height/2){ li.after(dragged); }else{ li.before(dragged); } });
});
}
function reorderTasks(){ 
const newTasks=[]; 
document.querySelectorAll('#taskList li').forEach(li=>{ 
const idx=parseInt(li.dataset.index); 
if(!isNaN(idx)) newTasks.push(tasks[idx]); 
});
tasks=newTasks;
localStorage.setItem("tasks",JSON.stringify(tasks));
renderTasks();
}

// ===== TOAST =====
function showToast(msg){ const toast = document.getElementById('toast'); toast.textContent = msg; toast.style.display='block'; setTimeout(()=>{toast.style.display='none';},2000); }

// ===== INIT =====
function renderAll(){ renderInventory(); renderTasks(); updateChart(); updateAlerts(); }
window.onload = function(){
    const user = localStorage.getItem('username');
    if(user){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('mainApp').style.display='block';
        document.getElementById('navUser').textContent = user+' ('+localStorage.getItem('role')+')';
        renderAll(); applyRoleRestrictions();
    }
}
</script>
</body>
</html>
