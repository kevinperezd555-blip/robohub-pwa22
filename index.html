<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RoboHub Ultimate Pro+</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; transition:0.3s; }
body.dark { background:#1a1a1a; color:white; }
nav { background:#222; color:white; display:flex; gap:10px; padding:10px; flex-wrap:wrap; }
nav button, nav label { background:none; border:none; color:white; cursor:pointer; }
.container { padding:20px; }
.card { background:white; padding:20px; margin-bottom:20px; border-radius:8px; transition:0.3s; }
body.dark .card { background:#333; }
.btn { background:#007bff; color:white; border:none; padding:8px 12px; cursor:pointer; border-radius:4px; }
.ghost { background:#ddd; border:none; padding:8px 12px; cursor:pointer; border-radius:4px; }
input, select { padding:8px; border-radius:4px; border:1px solid #ccc; }
ul { list-style:none; padding:0; }
li { padding:6px 0; display:flex; justify-content:space-between; align-items:center; cursor:grab; }
li.dragging { opacity:0.5; }
.priority-high { color:#dc3545; font-weight:bold; }
.priority-medium { color:#ffc107; font-weight:bold; }
.priority-low { color:#28a745; font-weight:bold; }
#toast { position:fixed; bottom:10px; right:10px; background:#222; color:white; padding:10px 15px; border-radius:5px; display:none; }
canvas { max-width:100%; height:auto; }
.alert { background:#dc3545; color:white; padding:8px; margin-bottom:10px; border-radius:5px; position:relative; }
</style>
</head>
<body>

<audio id="alertSound" src="https://www.myinstants.com/media/sounds/bleep.mp3"></audio>
<div id="toast"></div>

<!-- LOGIN -->
<div id="loginScreen" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;gap:10px;">
<h1>üîê RoboHub Ultimate Pro+</h1>
<input id="username" placeholder="Username"/>
<input id="password" placeholder="Password" type="password"/>
<select id="role">
<option value="student">Student</option>
<option value="teacher">Teacher</option>
</select>
<div style="display:flex;gap:10px;">
<button class="btn" onclick="signIn()">Sign In</button>
<button class="ghost" onclick="autofillDemo()">Quick demo</button>
</div>
</div>

<!-- APP -->
<div id="mainApp" style="display:none;">
<nav>
<button onclick="showSection('dashboard')">Dashboard</button>
<button onclick="showSection('inventory')">Inventory</button>
<button onclick="showSection('tasks')">Tasks</button>
<button onclick="toggleDarkMode()">üåì Dark Mode</button>
<button onclick="signOut()">Logout</button>
</nav>
<div class="container">
<div class="card" id="welcomeCard">Welcome to RoboHub Ultimate Pro+</div>

<!-- Alerts -->
<div id="alerts" class="card"></div>

<!-- Dashboard -->
<div id="dashboard" class="section">
<h2>üìä Dashboard</h2>
<canvas id="taskChart"></canvas>
</div>

<!-- Inventory -->
<div id="inventory" class="section" style="display:none;">
<h2>üì¶ Inventory</h2>
<input type="text" id="inventorySearch" placeholder="Search inventory..." onkeyup="renderInventory()"/>
<ul id="inventoryList"></ul>
<button class="btn" id="addInventoryBtn" onclick="addInventory()">+ Add Item</button>
</div>

<!-- Tasks -->
<div id="tasks" class="section" style="display:none;">
<h2>üìù Tasks</h2>
<input type="text" id="taskSearch" placeholder="Search tasks..." onkeyup="renderTasks()"/>
<ul id="taskList"></ul>
<button class="btn" id="addTaskBtn" onclick="addTask()">+ Add Task</button>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== DATA =====
let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

// ===== LOGIN =====
function signIn(){
const username = document.getElementById('username').value.trim();
const password = document.getElementById('password').value.trim();
const role = document.getElementById('role').value;
if(username && password){
localStorage.setItem('username', username);
localStorage.setItem('role', role);
document.getElementById('loginScreen').style.display='none';
document.getElementById('mainApp').style.display='block';
document.getElementById('welcomeCard').textContent = `Welcome, ${username}! (${role})`;
renderAll(); showSection('dashboard'); applyRoleRestrictions(); showToast('Signed in as '+username);
}else alert("Enter username and password.");
}
function signOut(){ localStorage.removeItem('username'); localStorage.removeItem('role'); document.getElementById('mainApp').style.display='none'; document.getElementById('loginScreen').style.display='flex'; showToast('Signed out'); }
function autofillDemo(){ document.getElementById('username').value="demoUser"; document.getElementById('password').value="demoPass"; }

// ===== ROLES =====
function applyRoleRestrictions(){
const role = localStorage.getItem('role');
document.getElementById("addInventoryBtn").style.display=(role==='teacher')?"inline-block":"none";
document.getElementById("addTaskBtn").style.display=(role==='teacher')?"inline-block":"none";
renderAll(); updateChart(); updateAlerts(); enableDragDrop();
}
function toggleDarkMode(){ document.body.classList.toggle('dark'); }
function switchRole(newRole){ localStorage.setItem('role', newRole); document.getElementById('welcomeCard').textContent = `Welcome, ${localStorage.getItem('username')}! (${newRole})`; applyRoleRestrictions(); showToast('Switched role to '+newRole); }

// ===== INVENTORY =====
function renderInventory(){
const search = document.getElementById("inventorySearch")?.value.toLowerCase()||"";
const list = document.getElementById("inventoryList"); if(!list) return; list.innerHTML="";
inventory.forEach((item, idx)=>{
if(item.name.toLowerCase().includes(search)){
const li = document.createElement("li");
let lowStock = item.qty<=2 ? " üî¥" : "";
li.innerHTML=`${item.name} (Qty: ${item.qty})${lowStock} ${localStorage.getItem('role')==='teacher'? `<button onclick="deleteInventory(${idx})">Delete</button>`:""}`;
list.appendChild(li);
}
}); updateAlerts();
}
function addInventory(){ const name = prompt("Item name:"); const qty = parseInt(prompt("Quantity:"),10); if(name && !isNaN(qty)){ inventory.push({name,qty}); localStorage.setItem("inventory",JSON.stringify(inventory)); renderInventory(); showToast('Inventory added'); } }
function deleteInventory(i){ inventory.splice(i,1); localStorage.setItem("inventory",JSON.stringify(inventory)); renderInventory(); showToast('Inventory deleted'); }

// ===== TASKS =====
function renderTasks(){
const search=document.getElementById("taskSearch")?.value.toLowerCase()||"";
const list=document.getElementById("taskList"); if(!list) return; list.innerHTML="";
tasks.sort((a,b)=> new Date(a.due||0)-new Date(b.due||0));
tasks.forEach((t, idx)=>{
if(t.text.toLowerCase().includes(search)){
const priorityClass = t.priority==='High'? 'priority-high': t.priority==='Medium'? 'priority-medium':'priority-low';
const role = localStorage.getItem('role');
const username = localStorage.getItem('username');
const studentButton = (role==='student' && username===t.assignee && !t.done)? `<button onclick="completeTask(${idx})">Mark Done</button>`:"";
const teacherButtons = (role==='teacher')? `<button onclick="deleteTask(${idx})">Delete</button>`:"";
const dueText = t.due? ` | Due: ${t.due}`:"";
const doneMark = t.done? " ‚úÖ":"";
const li = document.createElement("li");
li.dataset.index=idx;
li.innerHTML=`<span class="${priorityClass}">${t.text} (assigned: ${t.assignee})${dueText}</span> ${teacherButtons} ${studentButton} ${doneMark}`;
list.appendChild(li);
}
}); updateChart(); updateAlerts(); enableDragDrop();
}
function addTask(){ 
const text = prompt("Task description:"); 
const assignee = prompt("Assign to (username):");
const priority = prompt("Priority: High / Medium / Low","Medium"); 
const due = prompt("Due date (YYYY-MM-DD):","");
if(text && assignee){ tasks.push({text,assignee,priority,done:false,due}); localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task added'); }
}
function completeTask(i){ tasks[i].done=true; localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task completed'); }
function deleteTask(i){ tasks.splice(i,1); localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); showToast('Task deleted'); }

// ===== DASHBOARD =====
let chart;
function updateChart(){ const ctx=document.getElementById('taskChart')?.getContext('2d'); if(!ctx) return; const completed=tasks.filter(t=>t.done).length; const pending=tasks.filter(t=>!t.done).length; if(chart) chart.destroy(); chart=new Chart(ctx,{type:'doughnut',data:{labels:['Completed','Pending'],datasets:[{data:[completed,pending],backgroundColor:['#28a745','#dc3545']}]},options:{responsive:true}}); }

// ===== ALERTS =====
function updateAlerts(){
const alertsDiv=document.getElementById('alerts'); if(!alertsDiv) return; alertsDiv.innerHTML="";
const today=new Date(); 
let playSound=false;
tasks.forEach(t=>{
if(!t.done && t.due && new Date(t.due)<today){
const div=document.createElement("div"); div.className="alert"; div.textContent=`Overdue task: ${t.text} (assigned: ${t.assignee})`; alertsDiv.appendChild(div); playSound=true;
}
});
inventory.forEach(item=>{
if(item.qty<=2){ const div=document.createElement("div"); div.className="alert"; div.textContent=`Low stock: ${item.name} (${item.qty})`; alertsDiv.appendChild(div); playSound=true; }
});
if(playSound){ document.getElementById('alertSound')?.play(); }
}

// ===== DRAG & DROP =====
function enableDragDrop(){
const role = localStorage.getItem('role'); 
if(role!=='teacher') return;
const list=document.getElementById('taskList'); 
if(!list) return;
let dragged=null;
[...list.children].forEach(li=>{
li.draggable=true;
li.addEventListener('dragstart', e=>{ dragged=li; li.classList.add('dragging'); });
li.addEventListener('dragend', e=>{ dragged=null; li.classList.remove('dragging'); reorderTasks(); });
li.addEventListener('dragover', e=>{ e.preventDefault(); const bounding = li.getBoundingClientRect(); const offset = e.clientY - bounding.top; if(offset>bounding.height/2){ li.after(dragged); }else{ li.before(dragged); } });
});
}
function reorderTasks(){ 
const newTasks=[]; 
document.querySelectorAll('#taskList li').forEach(li=>{ 
const idx=parseInt(li.dataset.index); 
if(!isNaN(idx)) newTasks.push(tasks[idx]); 
});
tasks=newTasks;
localStorage.setItem("tasks",JSON.stringify(tasks));
renderTasks();
}

// ===== UTILS =====
function renderAll(){ renderInventory(); renderTasks(); updateChart(); updateAlerts(); }
function showSection(sectionId){ document.querySelectorAll('.section').forEach(s => s.style.display='none'); const sec = document.getElementById(sectionId); if(sec) sec.style.display='block'; }
function showToast(msg){ const toast = document.getElementById('toast'); toast.textContent = msg; toast.style.display='block'; setTimeout(()=>{toast.style.display='none';},2000); }

// ===== AUTO LOGIN =====
window.onload = function(){
    const user = localStorage.getItem('username');
    if(user){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('mainApp').style.display='block';
        document.getElementById('welcomeCard').textContent = `Welcome, ${user}! (${localStorage.getItem('role')})`;
        renderAll(); applyRoleRestrictions(); showSection('dashboard');
    }
}
</script>
</body>
</html>
